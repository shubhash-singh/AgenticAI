{
  "fixed": true,
  "index.html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Thermal Equilibrium - Interactive Simulation</title>\n    <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n            line-height: 1.6;\n            color: #333;\n            background: #f9f9f9;\n        }\n        #app {\n            max-width: 600px;\n            margin: 0 auto;\n            padding: 16px;\n            background: white;\n            min-height: 100vh;\n            box-shadow: 0 0 10px rgba(0,0,0,0.05);\n        }\n        header {\n            padding: 16px 0;\n            text-align: center;\n            border-bottom: 2px solid #e0e0e0;\n        }\n        h1 { font-size: 24px; margin-bottom: 8px; color: #333333; }\n        .subtitle { font-size: 14px; color: #666; }\n\n        #visual-area {\n            position: relative;\n            height: 50vh;\n            min-height: 300px;\n            background: #f5f5f5;\n            border-radius: 8px;\n            margin: 16px 0;\n            display: flex; /* Center SVG */\n            justify-content: center;\n            align-items: center;\n            overflow: hidden;\n            box-shadow: inset 0 0 5px rgba(0,0,0,0.05);\n        }\n        #thermo-svg {\n            width: 90%;\n            max-width: 400px;\n            height: auto;\n            background-color: #fff;\n            border-radius: 8px;\n            box-shadow: 0 4px 10px rgba(0,0,0,0.1);\n        }\n\n        #controls {\n            padding: 16px;\n            background: #fafafa;\n            border-radius: 8px;\n            margin: 16px 0;\n        }\n\n        .control-group {\n            margin: 16px 0;\n        }\n\n        .control-label {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 8px;\n            font-weight: 500;\n            font-size: 16px;\n        }\n\n        input[type=\"range\"] {\n            width: 100%;\n            height: 44px; /* Ensure sufficient touch target */\n            cursor: grab;\n            -webkit-appearance: none;\n            background: #e0e0e0;\n            border-radius: 5px;\n            outline: none;\n            transition: background 0.2s;\n        }\n        input[type=\"range\"]::-webkit-slider-thumb {\n            -webkit-appearance: none;\n            height: 24px;\n            width: 24px;\n            border-radius: 50%;\n            background: #4169E1;\n            cursor: grab;\n            box-shadow: 0 0 5px rgba(0,0,0,0.2);\n        }\n        input[type=\"range\"]::-moz-range-thumb {\n            height: 24px;\n            width: 24px;\n            border-radius: 50%;\n            background: #4169E1;\n            cursor: grab;\n            box-shadow: 0 0 5px rgba(0,0,0,0.2);\n        }\n        input[type=\"range\"]:active::-webkit-slider-thumb {\n            cursor: grabbing;\n            transform: scale(1.1);\n        }\n        input[type=\"range\"]:active::-moz-range-thumb {\n            cursor: grabbing;\n            transform: scale(1.1);\n        }\n\n        button {\n            width: 100%;\n            min-height: 48px; /* Increased touch target */\n            padding: 12px;\n            font-size: 16px;\n            color: white;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            margin: 8px 0;\n            transition: background-color 0.3s ease, transform 0.1s ease;\n        }\n\n        button#toggleContact_button { background: #007bff; }\n        button#toggleContact_button.active { background: #dc3545; }\n        button#reset_button { background: #6c757d; }\n\n        button:hover {\n            opacity: 0.9;\n        }\n        button:active {\n            transform: scale(0.98);\n        }\n\n        #info {\n            padding: 16px;\n            background: #e3f2fd;\n            border-radius: 8px;\n            margin: 16px 0;\n            font-size: 14px;\n        }\n        #info p {\n            margin-bottom: 4px;\n        }\n        #info p:last-child {\n            margin-bottom: 0;\n        }\n\n        /* Specific SVG styles */\n        #objectA, #objectB {\n            transition: fill 0.3s ease;\n        }\n        #heatPath {\n            transition: stroke 0.3s ease, stroke-opacity 0.3s ease;\n        }\n        text {\n            user-select: none;\n            pointer-events: none;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"app\">\n        <header>\n            <h1>Thermal Equilibrium</h1>\n            <p class=\"subtitle\">Observe heat transfer between two objects until equilibrium.</p>\n        </header>\n\n        <div id=\"visual-area\">\n            <svg id=\"thermo-svg\" viewBox=\"0 0 400 200\" preserveAspectRatio=\"xMidYMid meet\">\n                <!-- SVG Filters for glow -->\n                <defs>\n                    <filter id=\"glowFilter\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n                        <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"3\" result=\"blur\"></feGaussianBlur>\n                        <feFlood flood-color=\"#FFD700\" flood-opacity=\"0.8\" result=\"color\"></feFlood>\n                        <feComposite in=\"color\" in2=\"blur\" operator=\"in\" result=\"glow\"></feComposite>\n                        <feMerge>\n                            <feMergeNode in=\"glow\"></feMergeNode>\n                            <feMergeNode in=\"SourceGraphic\"></feMergeNode>\n                        </feMerge>\n                    </filter>\n                </defs>\n\n                <!-- Object A -->\n                <rect id=\"objectA\" x=\"50\" y=\"50\" width=\"100\" height=\"100\" rx=\"10\" ry=\"10\" fill=\"#4169E1\"></rect>\n                <text id=\"tempA_display\" x=\"100\" y=\"40\" text-anchor=\"middle\" font-size=\"20\" fill=\"#333333\">0°C</text>\n\n                <!-- Object B -->\n                <rect id=\"objectB\" x=\"250\" y=\"50\" width=\"100\" height=\"100\" rx=\"10\" ry=\"10\" fill=\"#ADD8E6\"></rect>\n                <text id=\"tempB_display\" x=\"300\" y=\"40\" text-anchor=\"middle\" font-size=\"20\" fill=\"#333333\">0°C</text>\n\n                <!-- Heat path (initially hidden) -->\n                <path id=\"heatPath\" d=\"M150 100 C175 85, 225 85, 250 100 C225 115, 175 115, 150 100 Z\" fill=\"none\" stroke=\"transparent\" stroke-width=\"4\" stroke-linecap=\"round\" stroke-linejoin=\"round\" style=\"filter: url(#glowFilter);\"></path>\n\n                <!-- Particle container (for animation) -->\n                <g id=\"particleContainer\"></g>\n            </svg>\n        </div>\n\n        <div id=\"controls\">\n            <div class=\"control-group\">\n                <div class=\"control-label\">\n                    <span>Initial Temperature A:</span>\n                    <span id=\"initialTempA_value\">50°C</span>\n                </div>\n                <input type=\"range\" id=\"initialTempA_slider\" min=\"0\" max=\"100\" value=\"50\">\n            </div>\n\n            <div class=\"control-group\">\n                <div class=\"control-label\">\n                    <span>Initial Temperature B:</span>\n                    <span id=\"initialTempB_value\">50°C</span>\n                </div>\n                <input type=\"range\" id=\"initialTempB_slider\" min=\"0\" max=\"100\" value=\"50\">\n            </div>\n\n            <div class=\"control-group\">\n                <button id=\"toggleContact_button\">Establish Thermal Contact</button>\n            </div>\n\n            <div class=\"control-group\">\n                <button id=\"reset_button\">Reset Simulation</button>\n            </div>\n        </div>\n\n        <div id=\"info\">\n            <p><strong>Simulation Status:</strong> <span id=\"simStatus\">Ready</span></p>\n            <p><strong>Current Thermal Contact:</strong> <span id=\"currentContactStatus\">OFF</span></p>\n            <p><strong>Equilibrium Reached:</strong> <span id=\"equilibriumStatus\">No</span></p>\n        </div>\n    </div>\n\n    <script>\n        // DOM elements\n        const objectA = document.getElementById('objectA');\n        const objectB = document.getElementById('objectB');\n        const tempA_display = document.getElementById('tempA_display');\n        const tempB_display = document.getElementById('tempB_display');\n        const heatPath = document.getElementById('heatPath');\n        const particleContainer = document.getElementById('particleContainer');\n\n        const initialTempA_slider = document.getElementById('initialTempA_slider');\n        const initialTempA_value = document.getElementById('initialTempA_value');\n        const initialTempB_slider = document.getElementById('initialTempB_slider');\n        const initialTempB_value = document.getElementById('initialTempB_value');\n        const toggleContact_button = document.getElementById('toggleContact_button');\n        const reset_button = document.getElementById('reset_button');\n\n        const simStatus = document.getElementById('simStatus');\n        const currentContactStatus = document.getElementById('currentContactStatus');\n        const equilibriumStatus = document.getElementById('equilibriumStatus');\n\n        // Simulation state variables\n        let tempA = 50;\n        let tempB = 50;\n        let initialTempA = 50;\n        let initialTempB = 50;\n        let thermalContact = false;\n        let isEquilibrium = false;\n        let animationFrameId = null;\n        let lastTime = 0; // For delta time calculation\n\n        // Simulation constants\n        const K_HEAT_TRANSFER = 0.08; // Heat transfer coefficient (arbitrary for visual effect)\n        const EQUILIBRIUM_THRESHOLD = 0.3; // Temperature difference to consider equilibrium\n        const MAX_PARTICLES = 30;\n        const PARTICLE_SPEED = 60; // SVG units per second\n        const PARTICLE_LIFETIME = 2; // Seconds\n        const PARTICLE_SIZE = 4; // Radius\n        let particles = [];\n\n        // Color scheme from blueprint\n        const COLORS = {\n            HOT: \"#FF4500\",      // OrangeRed\n            WARM: \"#FFD700\",    // Gold\n            COOL: \"#ADD8E6\",     // LightBlue\n            COLD: \"#4169E1\",     // RoyalBlue\n            WHITE: \"#FFFFFF\",\n            DARK: \"#333333\"\n        };\n\n        // Helper function to interpolate between two hex colors\n        function hexToRgb(hex) {\n            const r = parseInt(hex.substring(1, 3), 16);\n            const g = parseInt(hex.substring(3, 5), 16);\n            const b = parseInt(hex.substring(5, 7), 16);\n            return { r, g, b };\n        }\n\n        function rgbToHex(r, g, b) {\n            return \"#\" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\n        }\n\n        function lerpColor(color1Hex, color2Hex, factor) {\n            const c1 = hexToRgb(color1Hex);\n            const c2 = hexToRgb(color2Hex);\n\n            const r = Math.round(c1.r + factor * (c2.r - c1.r));\n            const g = Math.round(c1.g + factor * (c2.g - c1.g));\n            const b = Math.round(c1.b + factor * (c2.b - c1.b));\n\n            return rgbToHex(r, g, b);\n        }\n\n        // Map temperature to a color from the scheme\n        function tempToColor(temp) {\n            // Clamp temp between 0 and 100 for consistent color mapping\n            temp = Math.max(0, Math.min(100, temp));\n\n            if (temp <= 25) { // 0-25°C: Cold to Cool\n                const factor = temp / 25;\n                return lerpColor(COLORS.COLD, COLORS.COOL, factor);\n            } else if (temp <= 75) { // 25-75°C: Cool to Warm\n                const factor = (temp - 25) / 50;\n                return lerpColor(COLORS.COOL, COLORS.WARM, factor);\n            } else { // 75-100°C: Warm to Hot\n                const factor = (temp - 75) / 25;\n                return lerpColor(COLORS.WARM, COLORS.HOT, factor);\n            }\n        }\n\n        // Update visual elements (colors, text)\n        function updateObjectVisuals() {\n            try {\n                objectA.style.fill = tempToColor(tempA);\n                objectB.style.fill = tempToColor(tempB);\n                tempA_display.textContent = `${tempA.toFixed(1)}°C`;\n                tempB_display.textContent = `${tempB.toFixed(1)}°C`;\n\n                // Update heat path stroke based on temperature difference\n                if (thermalContact && !isEquilibrium && Math.abs(tempA - tempB) > EQUILIBRIUM_THRESHOLD) {\n                    // Path color slightly towards hotter, and visible\n                    const pathFillColor = tempA > tempB ? COLORS.HOT : COLORS.WARM;\n                    heatPath.setAttribute('stroke', pathFillColor);\n                    heatPath.setAttribute('stroke-opacity', 0.7);\n                } else {\n                    heatPath.setAttribute('stroke', 'transparent');\n                    heatPath.setAttribute('stroke-opacity', 0);\n                }\n            } catch (error) {\n                console.error('Error updating object visuals:', error);\n            }\n        }\n\n        // Update info panel text\n        function updateInfoPanel() {\n            currentContactStatus.textContent = thermalContact ? 'ON' : 'OFF';\n            equilibriumStatus.textContent = isEquilibrium ? 'Yes' : 'No';\n        }\n\n        // Particle management and animation\n        function updateParticles(dt) {\n            if (!thermalContact || isEquilibrium) {\n                particles.forEach(p => { if (p.element) p.element.remove(); });\n                particles.length = 0;\n                particleContainer.innerHTML = ''; // Clear any remaining elements\n                return;\n            }\n\n            const direction = tempA > tempB ? 1 : -1; // 1: A to B, -1: B to A\n            const startX = direction === 1 ? 150 : 250;\n            const endX = direction === 1 ? 250 : 150;\n\n            // Generate new particles\n            if (particles.length < MAX_PARTICLES && Math.random() < 0.1) { // Random chance to spawn each frame\n                const particleColor = direction === 1 ? COLORS.HOT : COLORS.WARM; // From hotter object\n                const newParticle = {\n                    id: Date.now() + Math.random(),\n                    x: startX + direction * 5, // Start slightly into the gap\n                    y: 100 + (Math.random() - 0.5) * 15, // Vertical wiggle\n                    opacity: 1,\n                    element: null, \n                    age: 0, // Age in seconds\n                    direction: direction\n                };\n                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n                circle.setAttribute('r', PARTICLE_SIZE / 2);\n                circle.setAttribute('fill', particleColor);\n                circle.setAttribute('opacity', newParticle.opacity);\n                particleContainer.appendChild(circle);\n                newParticle.element = circle;\n                particles.push(newParticle);\n            }\n\n            // Update existing particles\n            particles = particles.filter(p => {\n                p.age += dt;\n\n                // Move particle linearly and add wavy motion\n                p.x += p.direction * PARTICLE_SPEED * dt;\n                p.y += Math.sin(p.x / 15) * p.direction * 0.5; // Adjusted wavelength for smoother wave\n\n                // Fade out as it approaches destination or ages\n                const progress = Math.abs(p.x - startX) / Math.abs(endX - startX);\n                p.opacity = 1 - Math.pow(progress, 1.5); // Faster fade towards end\n                if (p.age > PARTICLE_LIFETIME * 0.75) { // Start fading out by age towards end of life\n                    p.opacity = Math.min(p.opacity, (PARTICLE_LIFETIME - p.age) / (PARTICLE_LIFETIME * 0.25));\n                }\n\n                if (p.element) {\n                    p.element.setAttribute('cx', p.x);\n                    p.element.setAttribute('cy', p.y);\n                    p.element.setAttribute('opacity', Math.max(0, p.opacity)); // Don't go below 0\n                }\n\n                // Remove if out of bounds or too old\n                const isOutOfBounds = (p.direction === 1 && p.x > endX + PARTICLE_SIZE) || (p.direction === -1 && p.x < endX - PARTICLE_SIZE);\n                const isTooOld = p.age > PARTICLE_LIFETIME;\n\n                if (isOutOfBounds || isTooOld) {\n                    if (p.element) {\n                        p.element.remove();\n                    }\n                    return false; // Remove from array\n                }\n                return true;\n            });\n        }\n\n        // Core simulation update loop\n        function updateSimulation(dt) {\n            try {\n                // Heat transfer (simplified model)\n                const tempDiff = tempA - tempB;\n\n                if (Math.abs(tempDiff) < EQUILIBRIUM_THRESHOLD) {\n                    isEquilibrium = true;\n                    simStatus.textContent = 'Equilibrium Reached';\n                    stopSimulation(); // Stops the animation frame loop\n                    return;\n                }\n\n                // Calculate heat flow and update temperatures\n                const heatFlow = K_HEAT_TRANSFER * tempDiff * dt; \n                tempA -= heatFlow; \n                tempB += heatFlow; \n\n                // Clamp temperatures to visual bounds\n                tempA = Math.max(0, Math.min(100, tempA));\n                tempB = Math.max(0, Math.min(100, tempB));\n\n                updateObjectVisuals();\n                updateParticles(dt);\n                updateInfoPanel();\n            } catch (error) {\n                console.error('Error in updateSimulation:', error);\n                stopSimulation(); // Attempt to stop on error\n            }\n        }\n\n        // Animation frame handler\n        function simulateFrame(currentTime) {\n            const deltaTime = (currentTime - lastTime) / 1000; // Convert ms to seconds\n            lastTime = currentTime;\n\n            if (thermalContact && !isEquilibrium) {\n                updateSimulation(deltaTime);\n                animationFrameId = requestAnimationFrame(simulateFrame);\n            } else {\n                stopSimulation();\n            }\n        }\n\n        // Start the simulation loop\n        function startSimulation() {\n            if (!thermalContact || isEquilibrium) { // Only start if contact is ON and not in equilibrium\n                return; \n            }\n            simStatus.textContent = 'Running';\n            lastTime = performance.now(); // Reset lastTime for smooth delta calculation\n            if (!animationFrameId) { // Prevent multiple requestAnimationFrame calls\n                animationFrameId = requestAnimationFrame(simulateFrame);\n            }\n        }\n\n        // Stop the simulation loop\n        function stopSimulation() {\n            if (animationFrameId) {\n                cancelAnimationFrame(animationFrameId);\n                animationFrameId = null;\n            }\n            if (!isEquilibrium) { // Don't overwrite if it says equilibrium reached\n                simStatus.textContent = 'Paused';\n            }\n            // Clear particles and hide heat path when contact is off or equilibrium reached\n            particles.forEach(p => { if (p.element) p.element.remove(); });\n            particles.length = 0;\n            heatPath.setAttribute('stroke', 'transparent');\n            heatPath.setAttribute('stroke-opacity', 0);\n        }\n\n        // Event Listeners\n        initialTempA_slider.addEventListener('input', (e) => {\n            initialTempA = parseFloat(e.target.value);\n            initialTempA_value.textContent = `${initialTempA}°C`;\n            if (!thermalContact || isEquilibrium) { // Only update current if not running or at equilibrium\n                tempA = initialTempA;\n                updateObjectVisuals();\n            }\n        });\n\n        initialTempB_slider.addEventListener('input', (e) => {\n            initialTempB = parseFloat(e.target.value);\n            initialTempB_value.textContent = `${initialTempB}°C`;\n            if (!thermalContact || isEquilibrium) { // Only update current if not running or at equilibrium\n                tempB = initialTempB;\n                updateObjectVisuals();\n            }\n        });\n\n        toggleContact_button.addEventListener('click', () => {\n            thermalContact = !thermalContact;\n            if (thermalContact) {\n                toggleContact_button.textContent = 'Break Thermal Contact';\n                toggleContact_button.classList.add('active');\n                isEquilibrium = false; // Reset equilibrium status when contact is established\n                startSimulation();\n            } else {\n                toggleContact_button.textContent = 'Establish Thermal Contact';\n                toggleContact_button.classList.remove('active');\n                stopSimulation();\n                simStatus.textContent = 'Ready';\n            }\n            updateInfoPanel();\n            updateObjectVisuals(); // Ensure path visibility is updated immediately\n        });\n\n        reset_button.addEventListener('click', () => {\n            try {\n                stopSimulation();\n                tempA = initialTempA;\n                tempB = initialTempB;\n                thermalContact = false;\n                isEquilibrium = false;\n\n                toggleContact_button.textContent = 'Establish Thermal Contact';\n                toggleContact_button.classList.remove('active');\n                \n                simStatus.textContent = 'Ready';\n                updateObjectVisuals();\n                updateInfoPanel();\n                particles.forEach(p => { if (p.element) p.element.remove(); });\n                particles.length = 0;\n            } catch (error) {\n                console.error('Error during reset:', error);\n            }\n        });\n\n        // Initial setup on page load\n        function init() {\n            tempA = parseFloat(initialTempA_slider.value);\n            tempB = parseFloat(initialTempB_slider.value);\n            initialTempA = tempA;\n            initialTempB = tempB;\n            initialTempA_value.textContent = `${initialTempA}°C`;\n            initialTempB_value.textContent = `${initialTempB}°C`;\n            updateObjectVisuals();\n            updateInfoPanel();\n        }\n\n        init();\n    </script>\n</body>\n</html>",
  "explanations": [
    "Ensured DOCTYPE, viewport meta tag, and HTML structure are valid.",
    "Applied flexbox properties to #visual-area to center its content (the SVG).",
    "Set `preserveAspectRatio=\"xMidYMid meet\"` on the SVG for proper scaling within its container.",
    "Increased the minimum height of buttons to 48px to meet touch target guidelines.",
    "Ensured all input range sliders have a sufficient touch target height of 44px.",
    "The `max-width` on `#app` and percentage-based `width` on `#thermo-svg` ensure responsiveness and prevent horizontal scrolling on smaller viewports.",
    "All JavaScript code is contained within the HTML and assumes DOM is ready. No specific DOMContentLoaded wrapper needed as script is at the end.",
    "Added CSS transitions for smoother visual feedback on object fills and heat path properties.",
    "Verified all event listeners are correctly attached to their respective elements.",
    "All variables are declared and initialized, and null checks are implicitly handled by `getElementById` returning `null` which would cause errors (though no specific errors were present in this regard).",
    "The `updateObjectVisuals` function correctly updates object colors and text content based on temperature.",
    "The simulation logic handles heat transfer and equilibrium conditions correctly.",
    "Particle animation logic is present and appears functional.",
    "The `reset_button` correctly resets the simulation state.",
    "The initial setup function `init()` correctly sets initial values and updates visuals on load."
  ]
}